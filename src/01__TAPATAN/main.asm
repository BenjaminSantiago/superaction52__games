;---------------------------------------------------------------
; SUPER ACTION 52 --> WEEK 02 --> TAPATAN
; by Benjamin Santiago
;---------------------------------------------------------------

;includes
;---------------------------------------------------------------
;header for this ROM
.INCLUDE "inc/header.inc"

;code to start up SNES (clear registers)
;and macros for graphics
.INCLUDE "inc/init.inc"
.INCLUDE "inc/load_graphics.asm"

;variables
;---------------------------------------------------------------'
.EQU    gameMODE    $0221

; game modes
;-----------
; 00 --> title
; 01 --> options? 
; 02 --> game -> drop phase
; 03 --> game -> move phase
; 04 --> game -> game over

.EQU    BOARD       $0222 ; -> 0224
.EQU    BOARD_01    $0223
.EQU    BOARD_02    $0224

; The BOARD 
;----------
; it has 9 locations, 3 rows of 3. 
; each location is represented by 2 bits 
; empty         -> 00
; p1 occupied   -> 01
; p2 occupied   -> 10

; memory locations
; $0222         - $0223         - $0224
; 00 00 00 | 00 - 00 00 | 00 00 - 00

; GAME BOARD ROWS
;   TOP    | MIDDLE     | BOTTOM
; 00 00 00 | 00 - 00 00 | 00 00 - 00



; M A I N  C O D E
; where the processor goes on reset
;---------------------------------------------------------------
.BANK 0 SLOT 0
.ORG 0
.SECTION "MainCode"

Start:
    ;start up the SNES
    InitSNES   

    ;"initialize" the "variables"
    ;------------------------------------------------------
    stz gameMODE
    stz BOARD
    ;------------------------------------------------------

    ; LOAD GRAPHICS
    ;------------------------------------------------------
    LoadPalette bg__palette, 0, 16 
    LoadPalette sprites__palette, 128, 16
    ; this actually loads everything (sprites + bg)
    LoadBlockToVRAM bg__tiles, $0000, $5010
    ;------------------------------------------------------
        
    ; TILE MAP
    ;------------------------------------------------------
    ; increment after writing to $2119
    lda #$80
    sta $2115

    ; tilemap offset --> $3000
    ; tilemap size   --> 1 screen in either direction
    lda #$30
    sta $2107

    ldx #$3000
    stx $2116

    rep #$10 
    
    ldx #$0000

bg_loop:
    ;load first tile
    lda.l tilemap__BG01, X
    sta $2118

    lda.l tilemap__BG01+1, X
    sta $2119 

    inx 
    inx

    cpx #$03A0 
    bne bg_loop
    ;------------------------------------------------------

    ; START IT UP!
    ;------------------------------------------------------
    ; we want BG 1 & BG 2 to be 16 x 16
    ; we want BG mode 1
    lda #%00110001
    sta $2105
   
    ; BG1 character VRAM offset
    stz $210B

    ; enable BG 1
    lda #%00000001
    sta $212C

    ; turn on screen full brightness
    lda #$0F
    sta $2100
    ;------------------------------------------------------


;M A I N  L O O P! 
;---------------------------------------------------------------
forever:
    wai;t for an interrupt y'all!
    ;TITLE
    ;----------------------------------------------------------
    ; title game code 
    ; --> display title
    ;----------------------------------------------------------

    ;GAME 
    ;----------------------------------------------------------

    ; --> drop phase
    ; ----> start player 1
    
    ; ----> current player drops
    
    ; --------> selection sound as they move locations
    ; --------> make sure location is legal
    ; --------> change color/make a bad ding if they try to drop
    ; --------> nice ding / animation if it works
    ; --------> update connector graphics
     
    ; --------> check win conditions 
    ; (only do this at the very end)

    ; ----> switch to other player (back up to current player drops)

    ; --> move phase

    ; ----> current player moves

    ; --------> selection sound as they move locations
    ; --------> player selects one of their things
    ; --------> player selects legal location to move to
    ; --------> process move

    ; --------> check win conditions

    ; --------> switch players
    
    ; --> game over 
    ; ----> who won?
    ; ----> show that player won 

    ; --> reset stuff
    ; --> go back to title    
    ;----------------------------------------------------------

    jmp forever    ;<-- we outttttt t t t t t t t
;---------------------------------------------------------------


;S U B R O U T I N E S

;NMI (vblank) code
;---------------------------------------------------------------
VBlank:
	pha
	phx
	phy
    

	PLY 
	PLX 
	PLA 

    sep #$20
    RTI

;---------------------------------------------------------------
; (END of SUBROUTINES)
.ENDS

; graphics
;---------------------------------------------------------------
.BANK 1 SLOT 0
.ORG 0
.SECTION "graphic_and_audio__includes"

; all the tiles for the game board
bg__palette:
    .incbin "_graphics/TAPATAN__bg.clr"
bg__tiles:
    .incbin "_graphics/TAPATAN__bg.pic"

; tiles for "coin" sprites, and cursor
sprites__palette: 
    .incbin "_graphics/TAPATAN__sprites.clr"
sprites__tiles: 
    .incbin "_graphics/TAPATAN__sprites.pic"

; sound stuff
spc_program:
    .incbin "spc__playWithCollide.bin"
    .incbin "audio/guitar_palmmuted__C__32k.BRR"
spcend:
        .db $FF

rando_map:
    .incbin "random_tilemap.bin"

tilemap__BG01:
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $000A, $400A, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $800A, $C00A, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
    .dw $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000, $0000
;---------------------------------------------------------------
.ENDS
